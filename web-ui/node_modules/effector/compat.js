'use strict';function e(e,r){for(var n in e)r(e[n],n)}function r(e,r){e.forEach(r)}function n(e,r){if(!e)throw Error(r)}function t(e,r){X={parent:X,value:e,template:q(e,'template')||Y(),sidRoot:q(e,'sidRoot')||X&&X.sidRoot};try{return r()}finally{X=N(X)}}function a(e){var n=void 0===e?{}:e,t=n.node,a=void 0===t?[]:t,o=n.parent,i=n.child,u=void 0===i?n.to||n.target:i,f=n.scope,c=void 0===f?{}:f,s=n.meta,l=void 0===s?{}:s,d=n.family,p=void 0===d?{type:'regular'}:d,v=n.regional,m=re(void 0===o?n.from||n.source:o),g=re(p.links),h=re(p.owners),y=[];r(a,(function(e){return e&&U(y,e)}));var b={id:Q(),seq:y,next:re(u),meta:l,scope:c,family:{type:p.type||"crosslink",links:g,owners:h}};return r(g,(function(e){return U(j(e),b)})),r(h,(function(e){return U(z(e),b)})),r(m,(function(e){return U(e.next,b)})),v&&X&&ee(O(X),[b]),b}function o(e,n,t){var a=_e,o=null,i=Oe;if(e.target&&(n=e.params,t=e.defer,a='page'in e?e.page:a,e.stack&&(o=e.stack),i=I(e)||i,e=e.target),i&&Oe&&i!==Oe&&(Oe=null),Array.isArray(e))for(var u=0;u<e.length;u++)Ne('pure',a,A(e[u]),o,n[u],i);else Ne('pure',a,A(e),o,n,i);if(!t||Ee){var f,c,s,l,d,p,v={isRoot:Ee,currentPage:_e,scope:Oe,isWatch:De,isPure:Re};Ee=0;for(var m=function(){var e=l.idx,n=l.stack,t=l.type;s=n.node,_e=d=n.page,Oe=I(n),d?p=d.reg:Oe&&(p=Oe.reg);var a=!!d,o=!!Oe,i={fail:0,scope:s.scope};f=c=0;for(var u=e;u<s.seq.length&&!f;u++){var m=s.seq[u];if(m.order){var g=m.order,h=g.priority,y=g.barrierID,b=y?d?d.fullID+"_"+y:y:0;if(u!==e||t!==h)return y?Fe.has(b)||(Fe.add(b),Ie(u,n,h,y)):Ie(u,n,h),"continue|kernelLoop";y&&Fe.delete(b)}switch(m.type){case'mov':var x=m.data,k=void 0;switch(x.from){case S:k=O(n);break;case"a":case'b':k=n[x.from];break;case"value":k=x.store;break;case"store":if(p&&!p[x.store.id])if(a){var w=Le(d,x.store.id);n.page=d=w,w?p=w.reg:o?(We(Oe,x.store,0,1,x.softRead),p=Oe.reg):p=void 0}else o&&We(Oe,x.store,0,1,x.softRead);k=we(p&&p[x.store.id]||x.store)}switch(x.to){case S:n.value=k;break;case"a":case'b':n[x.to]=k;break;case"store":Be(d,Oe,s,x.target).current=k}break;case'compute':var A=m.data;if(A.fn){De='watch'===q(s,'op'),Re=A.pure;var j=A.safe?(0,A.fn)(O(n),i.scope,n):He(i,A.fn,n);A.filter?c=!j:n.value=j,De=v.isWatch,Re=v.isPure}}f=i.fail||c}if(!f){var z=O(n),M=I(n);if(r(s.next,(function(e){Ne('child',d,e,n,z,M)})),M){q(s,'needFxCounter')&&Ne('child',d,M.fxCount,n,z,M),q(s,'storeChange')&&Ne('child',d,M.storeChange,n,z,M),q(s,'warnSerialize')&&Ne('child',d,M.warnSerializeNode,n,z,M);var C=M.additionalLinks[s.id];C&&r(C,(function(e){Ne('child',d,e,n,z,M)}))}}};l=Ce();)m();Ee=v.isRoot,_e=v.currentPage,Oe=I(v)}}function i(r,n){void 0===n&&(n='combine');var t=n+'(',a='',o=0;return e(r,(function(e){o<25&&(null!=e&&(t+=a,t+=D(e)?E(e).fullName:e.toString()),o+=1,a=', ')})),t+')'}function u(e,r){var n,t,a=e;if(r){var o=E(r);0===e.length?(n=o.path,t=o.fullName):(n=o.path.concat([e]),t=0===o.fullName.length?e:o.fullName+'/'+e)}else n=0===e.length?[]:[e],t=e;return{shortName:a,fullName:t,path:n}}function f(e,r){var n=r?e:e[0];oe(n);var t=n.or,a=n.and;if(a){var o=r?a:a[0];if(ne(o)&&'and'in o){var i=f(a,r);e=i[0],t=Object.assign({},t,i[1])}else e=a}return[e,t]}function c(e){var r=Y();if(r){for(var n=r.handlers[e],t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];if(n)return n.apply(void 0,[r].concat(a))}}function s(e,r,n,t){var a=_e,o=null;if(r)for(o=_e;o&&o.template!==r;)o=N(o);Ve(o);var i=e.create(n,t);return Ve(a),i}function l(e,r){var n=Ue({or:r,and:'string'==typeof e?{name:e}:e}),t=function e(r){$(!q(e,'derived'),'call of derived event','createEvent'),$(!Re,'unit call from pure function','operators like sample');for(var n=arguments.length,t=new Array(n>1?n-1:0),a=1;a<n;a++)t[a-1]=arguments[a];return _e?s(e,i,r,t):e.create(r,t)},i=Y(),u=Object.assign(t,{graphite:a({meta:er("event",t,n),regional:1}),create:function(e){return o({target:t,params:e,scope:Oe}),e},watch:function(e){return Ye(t,e)},map:function(e){return rr(t,w,e,[be()])},filter:function(e){return rr(t,"filter",e.fn?e:e.fn,[be(le,1)])},filterMap:function(e){return rr(t,'filterMap',e,[be(),he((function(e){return!ae(e)}),1)])},prepend:function(e){var r=l('* \u2192 '+t.shortName,{parent:N(t)});return c('eventPrepend',A(r)),Xe(r,t,[be()],'prepend',e),Ze(t,r),r}});return null!=n&&n.domain&&n.domain.hooks.event(u),u}function d(e,t){var i=Ue(t),u=ke(e),f=l({named:'updates',derived:1});c('storeBase',u);var s=u.id,p={subscribers:new Map,updates:f,defaultState:e,stateRef:u,getState:function(){var e,r=u;if(_e){for(var n=_e;n&&!n.reg[s];)n=N(n);n&&(e=n)}return!e&&Oe&&(We(Oe,u,1),e=Oe),e&&(r=e.reg[s]),we(r)},setState:function(e){return o({target:p,params:e,defer:1,scope:Oe})},reset:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return r(n,(function(e){return p.on(e,(function(){return p.defaultState}))})),p},on:function(e,t){return ue(e,'.on','first argument'),n(te(t),'second argument should be a function'),$(!q(p,'derived'),'.on in derived store','createStore'),r(Array.isArray(e)?e:[e],(function(e){p.off(e),C(p).set(e,Qe(nr(e,p,'on',se,t)))})),p},off:function(e){var r=C(p).get(e);return r&&(r(),C(p).delete(e)),p},map:function(e,r){var n,t;ne(e)&&(n=e,e=e.fn),$(ae(r),'second argument of store.map','updateFilter');var a=p.getState();Y()?t=null:ae(a)||(t=e(a,r));var o=d(t,{name:p.shortName+" \u2192 *",derived:1,and:n}),i=nr(p,o,w,ce,e);return Se(M(o),{type:w,fn:e,from:u}),M(o).noInit=1,c('storeMap',u,i),o},watch:function(e,r){if(!r||!D(e)){var t=Ye(p,e);return c('storeWatch',u,e)||e(p.getState()),t}return n(te(r),'second argument should be a function'),e.watch((function(e){return r(p.getState(),e)}))}},v=er("store",p,i),m=p.defaultConfig.updateFilter;p.graphite=a({scope:{state:u,fn:m},node:[he((function(e,r,n){return n.scope&&!n.scope.reg[u.id]&&(n.b=1),e})),ye(u),he((function(e,r,n){var t=n.a,a=n.b;return!ae(e)&&(e!==t||a)}),1),m&&be(ce,1),ve({from:S,target:u})],child:f,meta:v,regional:1});var g=q(p,'serialize'),h=q(p,'derived'),y='ignore'===g,b=!g||y?0:g,x=q(p,'sid');return x&&(y||F(p,'storeChange',1),u.sid=x,b&&(u.meta=Object.assign({},null==u?void 0:u.meta,{serialize:b}))),x||y||h||F(p,'warnSerialize',1),n(h||!ae(e),"current state can't be undefined, use null instead"),ee(p,[f]),null!=i&&i.domain&&i.domain.hooks.store(p),h||(p.reinit=l(),p.reset(p.reinit)),p}function p(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var a,o,i,u=f(r);i=u[1];var c,s,l,d=(r=u[0])[r.length-1];if(te(d)?(o=r.slice(0,-1),a=d):o=r,1===o.length){var p=o[0];_(p)||(c=p,s=1)}if(!s&&(c=o,a)){l=1;var v=a;a=function(e){return v.apply(void 0,e)}}return n(ne(c),'shape should be an object'),tr(Array.isArray(c),!l,c,i,a)}function v(){var e={};return e.req=new Promise((function(r,n){e.rs=r,e.rj=n})),e.req.catch((function(){})),e}function m(e,r){var t=Ue(te(e)?{handler:e}:e,r),i=l(te(e)?{handler:e}:e,r),u=A(i);F(u,'op',i.kind="effect"),i.use=function(e){return n(te(e),'.use argument should be a function'),g.scope.handler=e,i},i.use.getCurrent=function(){return g.scope.handler};var f=i.finally=l({named:'finally',derived:1}),c=i.done=f.filterMap({named:'done',fn:function(e){if('done'===e.status)return{params:e.params,result:e.result}}}),s=i.fail=f.filterMap({named:'fail',fn:function(e){if('fail'===e.status)return{params:e.params,error:e.error}}}),p=i.doneData=c.map({named:'doneData',fn:function(e){return e.result}}),m=i.failData=s.map({named:'failData',fn:function(e){return e.error}}),g=a({scope:{handlerId:q(u,'sid'),handler:i.defaultConfig.handler||function(){return n(0,"no handler used in "+i.getType())}},node:[he((function(e,r,n){var t=r,a=t.handler;if(I(n)){var o=I(n).handlers[t.handlerId];o&&(a=o)}return e.handler=a,e}),0,1),he((function(e,r,n){var t=e.params,a=e.req,o=e.handler,i=e.args,u=void 0===i?[t]:i,c=or(n),s=ir(t,a,1,f,n,c),l=ir(t,a,0,f,n,c),d=ar(o,l,u),p=d[1];d[0]&&(ne(p)&&te(p.then)?p.then(s,l):s(p))}),0,1)],meta:{op:'fx',fx:'runner'}});u.scope.runner=g,U(u.seq,he((function(e,r,n){var t=r.runner,a=N(n)?{params:e,req:{rs:function(){},rj:function(){}}}:e;return o({target:t,params:a,defer:1,scope:I(n)}),a.params}),0,1)),i.create=function(e){var r=v(),n={params:e,req:r};if(Oe){if(!De){var t=Oe;r.req.finally((function(){Pe(t)})).catch((function(){}))}o({target:i,params:n,scope:Oe})}else o(i,n);return r.req};var h=i.inFlight=d(0,{serialize:'ignore'}).on(i,(function(e){return e+1})).on(f,(function(e){return e-1})).map({fn:function(e){return e},named:'inFlight'});F(f,'needFxCounter','dec'),F(i,'needFxCounter',1);var y=i.pending=h.map({fn:function(e){return e>0},named:'pending'});return ee(i,[f,c,s,p,m,y,h]),null!=t&&t.domain&&t.domain.hooks.effect(i),i}function g(e,r){ue(e,'merge','first argument');var n=l({name:i(e,'merge'),derived:1,and:r});return Xe(e,n,[],'merge'),n}function h(e,t){var a=0;return r(fr,(function(r){r in e&&(n(null!=e[r],cr(t,r)),a=1)})),a}function y(e,n){var t=[];(function e(a){W(t,a)||(U(t,a),"store"===q(a,'op')&&q(a,'sid')&&n(a,q(a,'sid')),r(a.next,e),r(j(a),e),r(z(a),e))})(e)}function b(e,t){var a=Array.isArray(e)?new Map(e):e;if(a instanceof Map){var o={};return r(a,(function(e,r){n(D(r),'Map key should be a unit'),t&&t(r,e),n(r.sid,'unit should have a sid'),n(!(r.sid in o),'duplicate sid found'),o[r.sid]=e})),o}return a}function x(e){var r=function(){return e()};return r.unsubscribe=function(){return e()},r}Object.defineProperty(exports,'__esModule',{value:1});for(var k='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',w='map',S='stack',A=function(e){return e.graphite||e},j=function(e){return e.family.owners},z=function(e){return e.family.links},M=function(e){return e.stateRef},O=function(e){return e.value},C=function(e){return e.subscribers},N=function(e){return e.parent},I=function(e){return e.scope},q=function(e,r){return A(e).meta[r]},F=function(e,r,n){return A(e).meta[r]=n},E=function(e){return e.compositeName},D=function(e){return(te(e)||ne(e))&&'kind'in e},R=function(e){return function(r){return D(r)&&r.kind===e}},_=R("store"),P=R("event"),V=R("effect"),L=R("domain"),B=R("scope"),T={__proto__:null,unit:D,store:_,event:P,effect:V,domain:L,scope:B,attached:function(e){return V(e)&&1==q(e,'attached')}},W=function(e,r){return e.includes(r)},H=function(e,r){var n=e.indexOf(r);-1!==n&&e.splice(n,1)},U=function(e,r){return e.push(r)},$=function(e,r,n){return!e&&console.error(r+" is deprecated"+(n?", use "+n+" instead":''))},G=function(){var e=0;return function(){return""+ ++e}},J=G(),K=G(),Q=G(),X=null,Y=function(){return X&&X.template},Z=function(e){return e&&X&&X.sidRoot&&(e=X.sidRoot+"|"+e),e},ee=function(e,n){var t=A(e);r(n,(function(e){var r=A(e);"domain"!==t.family.type&&(r.family.type="crosslink"),U(j(r),t),U(z(t),r)}))},re=function(e){return void 0===e&&(e=[]),(Array.isArray(e)?e:[e]).flat().map(A)},ne=function(e){return'object'==typeof e&&null!==e},te=function(e){return'function'==typeof e},ae=function(e){return void 0===e},oe=function(e){return n(ne(e)||te(e),'expect first argument be an object')},ie=function(e,r,t,a){return n(!(!ne(e)&&!te(e)||!('family'in e)&&!('graphite'in e)),r+": expect "+t+" to be a unit (store, event or effect)"+a)},ue=function(e,n,t){Array.isArray(e)?r(e,(function(e,r){return ie(e,n,r+" item of "+t,'')})):ie(e,n,t,' or array of units')},fe=function(e,n,t){return void 0===t&&(t='target'),r(re(n),(function(r){return $(!q(r,'derived'),e+": derived unit in \""+t+"\"","createEvent/createStore")}))},ce=function(e,r,n){return(0,r.fn)(e,n.a)},se=function(e,r,n){return(0,r.fn)(n.a,e)},le=function(e,r){return(0,r.fn)(e)},de=function(e,r,n,t){var a={id:K(),type:e,data:r};return n&&(a.order={priority:n},t&&(a.order.barrierID=++pe)),a},pe=0,ve=function(e){var r=e.from,n=e.target,t=e.to;return de('mov',{from:void 0===r?"store":r,store:e.store,to:void 0===t?n?"store":S:t,target:n},e.priority,e.batch)},me=function(e){var r=e.safe,n=e.filter,t=e.pure;return de('compute',{fn:e.fn,safe:void 0===r?0:r,filter:void 0===n?0:n,pure:void 0===t?0:t},e.priority,e.batch)},ge=function(e){return me({fn:e.fn,priority:"effect"})},he=function(e,r,n){return me({fn:e,safe:1,filter:r,priority:n&&"effect"})},ye=function(e,r,n){return ve({store:e,to:r?S:"a",priority:n&&"sampler",batch:1})},be=function(e,r){return void 0===e&&(e=le),me({fn:e,pure:1,filter:r})},xe={mov:ve,compute:me,filter:function(e){return me({fn:e.fn,filter:1,pure:e.pure})},run:ge},ke=function(e){return{id:K(),current:e}},we=function(e){return e.current},Se=function(e,r){e.before||(e.before=[]),U(e.before,r)},Ae=null,je=function e(r,n){return r?n?((r.v.type===n.v.type&&r.v.id>n.v.id||qe(r.v.type)>qe(n.v.type))&&(t=r,r=n,n=t),t=e(r.r,n),r.r=r.l,r.l=t,r):r:n;var t},ze=[],Me=0;Me<6;)U(ze,{first:null,last:null,size:0}),Me+=1;var Oe,Ce=function(){for(var e=0;e<6;e++){var r=ze[e];if(r.size>0){if(3===e||4===e){r.size-=1;var n=Ae.v;return Ae=je(Ae.l,Ae.r),n}1===r.size&&(r.last=null);var t=r.first;return r.first=t.r,r.size-=1,t.v}}},Ne=function(e,r,n,t,a,o){return Ie(0,{a:null,b:null,node:n,parent:t,value:a,page:r,scope:o},e)},Ie=function(e,r,n,t){void 0===t&&(t=0);var a=qe(n),o=ze[a],i={v:{idx:e,stack:r,type:n,id:t},l:null,r:null};3===a||4===a?Ae=je(Ae,i):(0===o.size?o.first=i:o.last.r=i,o.last=i),o.size+=1},qe=function(e){switch(e){case'child':return 0;case'pure':return 1;case'read':return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},Fe=new Set,Ee=1,De=0,Re=0,_e=null,Pe=function(e){Oe=e},Ve=function(e){_e=e},Le=function(e,r){if(e){for(;e&&!e.reg[r];)e=N(e);if(e)return e}return null},Be=function(e,r,n,t,a){var o=Le(e,t.id);return o?o.reg[t.id]:r?(We(r,t,a),r.reg[t.id]):t},Te=function(e){return e},We=function e(n,t,a,o,i){var u,f=n.reg,c=t.sid,s=null==t||null===(u=t.meta)||void 0===u?void 0:u.serialize;if(!f[t.id]){var l={id:t.id,current:t.current,meta:t.meta};if(c&&c in n.sidValuesMap&&!(c in n.sidIdMap))l.current=(n.fromSerialize&&'ignore'!==s&&(null==s?void 0:s.read)||Te)(n.sidValuesMap[c]);else if(t.before&&!i){var d=0,p=a||!t.noInit||o;r(t.before,(function(r){switch(r.type){case w:var t=r.from;if(t||r.fn){t&&e(n,t,a,o);var i=t&&f[t.id].current;p&&(l.current=r.fn?r.fn(i):i)}break;case'field':d||(d=1,l.current=Array.isArray(l.current)?[].concat(l.current):Object.assign({},l.current)),e(n,r.from,a,o),p&&(l.current[r.field]=f[f[r.from.id].id].current)}}))}c&&(n.sidIdMap[c]=t.id),f[t.id]=l}},He=function(e,r,n){try{return r(O(n),e.scope,n)}catch(t){console.error(t),e.fail=1}},Ue=function r(n,t){return void 0===t&&(t={}),ne(n)&&(r(n.or,t),e(n,(function(e,r){ae(e)||'or'===r||'and'===r||(t[r]=e)})),r(n.and,t)),t},$e=function(e,r){H(e.next,r),H(j(e),r),H(z(e),r)},Ge=function e(r,n,t){var a;r.next.length=0,r.seq.length=0,r.scope=null;for(var o=z(r);a=o.pop();)$e(a,r),(n||t&&'sample'!==q(r,'op')||"crosslink"===a.family.type)&&e(a,n,'on'!==q(a,'op')&&t);for(o=j(r);a=o.pop();)$e(a,r),t&&"crosslink"===a.family.type&&e(a,n,'on'!==q(a,'op')&&t)},Je=function(e){return e.clear()},Ke=function(e,r){var n=(void 0===r?{}:r).deep,t=0;if(e.ownerSet&&e.ownerSet.delete(e),_(e))Je(C(e));else if(L(e)){t=1;var a=e.history;Je(a.events),Je(a.effects),Je(a.stores),Je(a.domains)}Ge(A(e),!!n,t)},Qe=function(e){var r=function(){return Ke(e)};return r.unsubscribe=r,r},Xe=function(e,r,n,t,o){return a({node:n,parent:e,child:r,scope:{fn:o},meta:{op:t},family:{owners:[e,r],links:r},regional:1})},Ye=function(e,r){return n(te(r),'.watch argument should be a function'),Qe(a({scope:{fn:r},node:[ge({fn:le})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))},Ze=function(e,r,n){void 0===n&&(n="event"),N(e)&&N(e).hooks[n](r)},er=function(e,r,n){var t=Ue(n),a="domain"===e,o=J(),i=t.sid,f=void 0===i?null:i,c=t.named,s=void 0===c?null:c,l=t.domain,d=t.parent,p=void 0===d?void 0===l?null:l:d,v=s||t.name||(a?'':o),m=u(v,p),g={op:r.kind=e,name:r.shortName=v,sid:r.sid=Z(f),named:s,unitId:r.id=o,serialize:t.serialize,derived:t.derived,config:t};if(r.parent=p,r.compositeName=m,r.defaultConfig=t,r.thru=function(e){return $(0,'thru','js pipe'),e(r)},r.getType=function(){return m.fullName},!a){r.subscribe=function(e){return oe(e),r.watch(te(e)?e:function(r){return e.next&&e.next(r)})},r[k]=function(){return r};var h=Y();h&&(g.nativeTemplate=h)}return g},rr=function(e,r,n,t){var a;ne(n)&&(a=n,n=n.fn);var o=l({name:e.shortName+" \u2192 *",derived:1,and:a});return Xe(e,o,t,r,n),o},nr=function(e,r,n,t,a){var o=M(r),i=ve({store:o,to:"a",priority:'read'});n===w&&(i.data.softRead=1);var u=[i,be(t)];return c('storeOnMap',o,u,_(e)&&M(e)),Xe(e,r,u,n,a)},tr=function(r,t,a,o,u){var f=r?function(e){return[].concat(e)}:function(e){return Object.assign({},e)},s=r?[]:{},l=f(s),p=ke(l),v=ke(1);p.type=r?'list':'shape',p.noInit=1,c('combineBase',p,v);var m=d(l,{name:i(a),derived:1,and:o}),g=M(m);g.noInit=1,F(m,'isCombine',1);var h=ye(p);h.order={priority:'barrier'};var y=[he((function(e,r,n){return n.scope&&!n.scope.reg[p.id]&&(n.c=1),e})),h,ve({store:v,to:'b'}),he((function(e,r,n){var a=r.key;if(n.c||e!==n.a[a])return t&&n.b&&(n.a=f(n.a)),n.a[a]=e,1}),1),ve({from:"a",target:p}),ve({from:"value",store:0,target:v}),ve({from:"value",store:1,target:v,priority:"barrier",batch:1}),ye(p,1),u&&be()];return e(a,(function(e,r){if(!_(e))return n(!D(e)&&!ae(e),"combine expects a store in a field "+r),void(l[r]=s[r]=e);s[r]=e.defaultState,l[r]=e.getState();var t=Xe(e,m,y,'combine',u);t.scope.key=r;var a=M(e);Se(p,{type:'field',field:r,from:a}),c('combineField',a,t)})),m.defaultShape=a,Se(g,{type:w,from:p,fn:u}),Y()||(m.defaultState=u?g.current=u(l):s),m},ar=function(e,r,n){try{return[1,e.apply(void 0,n)]}catch(t){return r(t),[0,null]}},or=function(e){var r=I(e),n={ref:r};return r&&U(r.activeEffects,n),n},ir=function(e,r,n,t,a,i){return function(u){i.ref&&H(i.ref.activeEffects,i),o({target:[t,ur],params:[n?{status:'done',params:e,result:u}:{status:'fail',params:e,error:u},{value:u,fn:n?r.rs:r.rj}],defer:1,page:a.page,scope:i.ref})}},ur=a({node:[ge({fn:function(e){return(0,e.fn)(e.value)}})],meta:{op:'fx',fx:'sidechain'}}),fr=['source','clock','target'],cr=function(e,r){return e+": "+r+" should be defined"},sr=function(e,r,t,a,o,i,u,f,s,v,m,h){var y=!!o;n(!ae(t)||!ae(r),cr(e,'either source or clock'));var b=0;ae(t)?b=1:D(t)||(t=p(t)),ae(r)?r=t:(ue(r,e,'clock'),Array.isArray(r)&&(r=g(r))),b&&(t=r),f||u||(u=t.shortName);var x='none';(m||a)&&(D(a)?x='unit':(n(te(a),'`filter` should be function or unit'),x='fn')),o?(ue(o,e,'target'),fe(e,o)):'none'===x&&v&&_(t)&&_(r)?o=d(i?i(we(M(t)),we(M(r))):we(M(t)),{name:u,sid:h,or:f}):(o=l({name:u,derived:1,or:f}),c('sampleTarget',A(o)));var k=ke(),w=[];if('unit'===x){var j=dr(a,o,r,k,e),z=j[0];w=[].concat(lr(j[1]),lr(z))}var O=dr(t,o,r,k,e),C=O[0],N=O[1],I=Xe(r,o,[c('sampleSourceLoader'),ve({from:S,target:k})].concat(lr(N),[ye(C,1,s)],w,[ye(k),'fn'===x&&be((function(e,r,n){return a(e,n.a)}),1),i&&be(ce),c('sampleSourceUpward',y)]),e,i);return ee(t,[I]),Object.assign(I.meta,f,{joint:1}),o},lr=function(e){return[ye(e),he((function(e,r,n){return n.a}),1)]},dr=function(e,r,n,t,o){var i=_(e),u=i?M(e):ke(),f=ke(i);return i||a({parent:e,node:[ve({from:S,target:u}),ve({from:"value",store:1,target:f})],family:{owners:[e,r,n],links:r},meta:{op:o},regional:1}),c('sampleSource',f,u,t),[u,f]},pr=function(e,r,n,t){var a=e[r];a&&o({target:a,params:Array.isArray(a)?a.map((function(){return n})):n,defer:1,stack:t})},vr=function(e){return e};exports.allSettled=function(e,r){var n=r.scope,t=r.params;if(!D(e))return Promise.reject(new Error('first argument should be unit'));if(!V(e)&&!P(e)&&!_(e))return Promise.reject(new Error('first argument accepts only effects, events and stores'));var a=v();a.parentFork=Oe;var i=n.fxCount;U(i.scope.defers,a);var u=[e],f=[];return U(f,V(e)?{params:t,req:{rs:function(e){a.value={status:'done',value:e}},rj:function(e){a.value={status:'fail',value:e}}}}:t),U(u,i),U(f,null),o({target:u,params:f,scope:n}),a.req},exports.attach=function(e){var r,n=f(e,1),t=(e=n[0]).source,a=e.effect,i=e.mapParams,c=m(e,n[1]);F(c,'attached',1);var s,l,d=A(c).scope.runner,v=he((function(e,r,n){var a,u=e.params,f=e.req,s=e.handler,l=c.finally,d=or(n),p=ir(u,f,0,l,n,d),v=n.a,m=V(s),g=1;if(i){var h=ar(i,p,[u,v]);g=h[0],a=h[1]}else a=t&&m?v:u;if(g){if(!m)return e.args=[v,a],1;o({target:s,params:{params:a,req:{rs:ir(u,f,1,l,n,d),rj:p}},page:n.page,defer:1})}}),1,1);t?(_(t)?ee(l=t,[c]):(l=p(t),ee(c,[l])),s=[ye(M(l)),v]):s=[v],(r=d.seq).splice.apply(r,[1,0].concat(s)),c.use(a);var g=N(a);return g&&(Object.assign(E(c),u(c.shortName,g)),c.defaultConfig.parent=g),Ze(a,c,"effect"),c},exports.clearNode=Ke,exports.combine=p,exports.createApi=function(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];var a=f(n),o=a[0],i=o[0],u=o[1],c=a[1],s={};return e(u,(function(e,r){var n=s[r]=l(r,{parent:N(i),config:c});i.on(n,e),Ze(i,n)})),s},exports.createDomain=function n(t,i){var u=Ue({or:i,and:'string'==typeof t?{name:t}:t}),f=a({family:{type:"domain"},regional:1,parent:(null==u?void 0:u.domain)||(null==u?void 0:u.parent)}),c={history:{},graphite:f,hooks:{}};f.meta=er("domain",c,{parent:(null==u?void 0:u.domain)||(null==u?void 0:u.parent),or:u}),e({Event:l,Effect:m,Store:d,Domain:n},(function(e,n){var t=n.toLowerCase(),a=l({named:"on"+n});c.hooks[t]=a;var i=new Set;c.history[t+"s"]=i,a.create=function(e){return o(a,e),e},U(A(a).seq,he((function(e,r,n){return n.scope=null,e}))),a.watch((function(e){ee(c,[e]),i.add(e),e.ownerSet||(e.ownerSet=i),N(e)||(e.parent=c)})),ee(c,[a]),c["onCreate"+n]=function(e){return r(i,e),a.watch(e)},c["create"+n]=c[t]=function(r,n){var t=Ue({and:n,or:r});return null!=t&&t.domain?e(r,n):a(e(r,{parent:c,or:t}))}}));var s=N(c);return s&&e(c.hooks,(function(e,r){return Xe(e,s.hooks[r])})),null!=u&&u.domain&&u.domain.hooks.domain(c),c},exports.createEffect=m,exports.createEvent=l,exports.createNode=a,exports.createStore=d,exports.createStoreObject=function(){return $(0,'createStoreObject','combine'),p.apply(void 0,arguments)},exports.createWatch=function(e){var r=e.unit,n=e.fn,t=e.scope,o=[xe.run({fn:function(e){return n(e)}})];if(t){var i=a({node:o}),u=r.graphite.id,f=t.additionalLinks,c=f[u]||[];return f[u]=c,c.push(i),x((function(){var e=c.indexOf(i);-1!==e&&c.splice(e,1),Ke(i)}))}var s=a({node:o,parent:[r],family:{owners:r}});return x((function(){Ke(s)}))},exports.fork=function(e,t){var o,i=e;L(e)&&(o=e,i=t);var u=function(e){var n=a({scope:{defers:[],inFlight:0,fxID:0},node:[he((function(e,r,n){N(n)?'dec'===q(N(n).node,'needFxCounter')?r.inFlight-=1:(r.inFlight+=1,r.fxID+=1):r.fxID+=1})),me({priority:"sampler",batch:1}),he((function(e,n){var t=n.defers,a=n.fxID;n.inFlight>0||0===t.length||Promise.resolve().then((function(){n.fxID===a&&r(t.splice(0,t.length),(function(e){Pe(e.parentFork),e.rs(e.value)}))}))}),0,1)]}),t=a({node:[he((function(e,r,n){var t=N(n);if(t){var a=t.node;if(!q(a,'isCombine')||N(t)&&'combine'!==q(N(t).node,'op')){var o=I(n),i=a.scope.state.id,u=q(a,'sid');o.sidIdMap[u]=i,o.sidValuesMap[u]=e;var f=q(a,'serialize');f&&'ignore'!==f&&(o.sidSerializeMap[u]=f.write)}}}))]}),o=a({node:[he((function(e,r,n){var t=I(n);if(t){var a=N(n);a&&(!q(a.node,'isCombine')||N(a)&&'combine'!==q(N(a).node,'op'))&&(t.warnSerialize=1)}}))]}),i={cloneOf:e,reg:{},sidValuesMap:{},sidIdMap:{},sidSerializeMap:{},getState:function(e){if('current'in e)return Be(_e,i,null,e).current;var r=A(e);return Be(_e,i,r,r.scope.state,1).current},kind:"scope",graphite:a({family:{type:"domain",links:[n,t,o]},meta:{unit:'fork'},scope:{forkInFlightCounter:n}}),additionalLinks:{},handlers:{},fxCount:n,storeChange:t,warnSerializeNode:o,activeEffects:[]};return i}(o);if(i){var f=i.scope;if(f){var c=f.activeEffects;f.activeEffects=[],u.activeEffects=c,r(c,(function(e){return e.ref=u}))}if(i.values){var s=b(i.values,(function(e){return n(_(e),'Values map can contain only stores as keys')}));Object.assign(u.sidValuesMap,s),u.fromSerialize=!(Array.isArray(i.values)||i.values instanceof Map)}i.handlers&&(u.handlers=b(i.handlers,(function(e){return n(V(e),"Handlers map can contain only effects as keys")})))}return u},exports.forward=function(e){var r='forward',n=f(e,1),t=n[0],o=t.from,i=t.to,u=n[1];return ue(o,r,'"from"'),ue(i,r,'"to"'),fe(r,i,'to'),Qe(a({parent:o,child:i,meta:{op:r,config:u},family:{},regional:1}))},exports.fromObservable=function(e){oe(e);var r=k in e?e[k]():e;n(r.subscribe,'expect observable to have .subscribe');var t=l(),a=Qe(t);return r.subscribe({next:t,error:a,complete:a}),t},exports.guard=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=f(r),a=t[0],o=a[0],i=a[1],u=t[1];return i||(o=(i=o).source),h(i,'guard'),sr('guard',i.clock,o,i.filter,i.target,null,i.name,u,!i.greedy,0,1)},exports.hydrate=function(e,r){var t=r.values;n(ne(t),'values property should be an object');var a,i,u,f=b(t),c=Object.getOwnPropertyNames(f),s=[],l=[];B(e)?(u=1,n((a=e).cloneOf,'scope should be created from domain'),i=A(a.cloneOf)):L(e)?i=A(e):n(0,'first argument of hydrate should be domain or scope'),y(i,(function(e,r){if(W(c,r)){U(s,e);var n=q(e,'serialize');n&&'ignore'!==n&&(f[r]=n.read(f[r])),U(l,f[r])}})),o({target:s,params:l,scope:a}),u&&Object.assign(a.sidValuesMap,f)},exports.is=T,exports.launch=o,exports.merge=g,exports.restore=function(r,n,t){if(_(r))return $(0,'restore($store)'),r;if(P(r)||V(r)){var a=N(r),o=d(n,{parent:a,name:r.shortName,and:t});return Xe(V(r)?r.doneData:r,o),a&&a.hooks.store(o),o}var i=Array.isArray(r)?[]:{};return e(r,(function(e,r){return i[r]=_(e)?e:d(e,{name:r})})),i},exports.sample=function(){for(var e,r,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];var o,i,u=f(t),c=u[0],s=c[0],l=c[1],d=c[2],p=u[1],v=1;return ae(l)&&ne(s)&&h(s,"sample")&&(l=s.clock,d=s.fn,v=!s.greedy,i=s.filter,e=s.target,r=s.name,o=s.sid,s=s.source),sr("sample",l,s,i,e,d,r,p,v,1,0,o)},exports.scopeBind=function(e,r){var t=void 0===r?{}:r,a=t.scope;n(a||Oe||t.safe,'scopeBind cannot be called outside of forked .watch');var i=a||Oe;return V(e)?function(r){var n=v();return o({target:e,params:{params:r,req:n},scope:i}),n.req}:function(r){return o({target:e,params:r,scope:i}),r}},exports.serialize=function(r,t){void 0===t&&(t={}),r.warnSerialize&&console.error('There is a store without sid in this scope, its value is omitted');var a=t.ignore?t.ignore.map((function(e){return e.sid})):[],o={};return e(r.sidValuesMap,(function(e,n){if(!W(a,n)){var t=r.sidIdMap[n];o[n]=(r.sidSerializeMap[n]||vr)(t&&t in r.reg?r.reg[t].current:e)}})),'onlyChanges'in t&&!t.onlyChanges&&(n(r.cloneOf,'scope should be created from domain'),y(A(r.cloneOf),(function(e,n){n in o||W(a,n)||q(e,'isCombine')||'ignore'===q(e,'serialize')||(o[n]=r.getState(e))}))),o},exports.setStoreName=function(e,r){e.shortName=r,Object.assign(E(e),u(r,N(e)))},exports.split=function(){for(var r,t,o='split',i=arguments.length,u=new Array(i),s=0;s<i;s++)u[s]=arguments[s];var d=f(u),p=d[0],v=p[0],m=p[1],g=d[1],h=!m;h&&(r=v.cases,m=v.match,t=v.clock,v=v.source);var y=_(m),b=!D(m)&&te(m),x=!y&&!b&&ne(m);r||(r={}),h?e(r,(function(e,r){return fe(o,e,"cases."+r)})):(n(x,'match should be an object'),e(m,(function(e,n){return r[n]=l({derived:1,and:g})})),r.__=l({derived:1,and:g}));var k,w=new Set([].concat(v,t||[],Object.values(r))),S=Object.keys(y||b?r:m);if(y||b)y&&w.add(m),k=[y&&ye(M(m),0,1),me({safe:y,filter:1,pure:!y,fn:function(e,r,n){var t=String(y?n.a:m(e));pr(r,W(S,t)?t:'__',e,n)}})];else if(x){var A=ke({});A.type='shape';var j,z=[];e(m,(function(e,r){if(D(e)){j=1,U(z,r),w.add(e);var n=Xe(e,[],[ye(A),he((function(e,n,t){return t.a[r]=e}))]);if(_(e)){A.current[r]=e.getState();var t=M(e);Se(A,{from:t,field:r,type:'field'}),c('splitMatchStore',t,n)}}})),j&&c('splitBase',A),k=[j&&ye(A,0,1),be((function(e,r,n){for(var t=0;t<S.length;t++){var a=S[t];if(W(z,a)?n.a[a]:m[a](e))return void pr(r,a,e,n)}pr(r,'__',e,n)}),1)]}else n(0,'expect match to be unit, function or object');var O=a({meta:{op:o},parent:t?[]:v,scope:r,node:k,family:{owners:Array.from(w)},regional:1});if(t&&sr(o,t,v,null,O,null,o,g,0,0,0),!h)return r},exports.step=xe,exports.version="22.4.0",exports.withFactory=function(e){var r=e.name,n=e.loc,o=e.method,i=e.fn;return t(a({meta:{sidRoot:Z(e.sid),name:r,loc:n,method:o}}),i)},exports.withRegion=t;
//# sourceMappingURL=compat.js.map
